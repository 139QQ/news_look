# 更新日志 (CHANGELOG)

本文档记录 NewsLook 项目的所有重要更新。

## [2025-05-29]

### 修复
- **修复数据中心趋势图显示问题**
  - 优化Chart.js图表初始化逻辑，解决趋势图无法显示的问题
  - 使用try/catch结构捕获JavaScript图表渲染错误，增强错误处理能力
  - 添加DOM元素存在性检查，确保在渲染前验证目标元素
  - 修复Jinja2模板变量与JavaScript变量传递问题，使用JSON.parse确保数据正确解析

### 优化
- 改进图表数据加载流程
  - 增强数据格式验证，避免无效数据导致图表渲染失败
  - 使用var替代const声明，避免潜在的作用域问题
  - 添加详细的控制台日志输出，便于调试和问题排查
  - 优化了空数据情况下的图表展示逻辑

## [2025-05-28]

### 新增
- **数据中心界面全面优化**，提升数据可视化体验
  - 左侧筛选栏在滚动时保持固定可见，便于随时调整筛选条件
  - 添加日期快捷选择功能，提供近7天、近14天、近30天等快速筛选选项
  - 增加筛选加载状态提示，提升交互反馈
  - 添加数据为空时的友好提示界面
  - 实现筛选条件的一键重置功能

### 修复
- 解决趋势图无法显示的问题，通过优化图表初始化和数据验证逻辑
- 修复已删除数据库的新闻仍显示在统计中的问题，添加数据库存在性检查
- 改进查询数据库的方式，确保使用有效的数据库路径

### 优化
- 调整左侧筛选区与主内容区域的布局比例，实现更合理的空间分配
- 优化图表和表格样式，提升数据可读性
  - 增强表格样式，添加行高、间距和背景色交替效果
  - 改进趋势图和来源分布图表的视觉效果
- 增强图表数据有效性验证，确保无效数据不影响图表显示
- 优化数据库连接和查询逻辑，提高数据加载性能
- 改进错误处理机制，提供更友好的错误提示

## [2025-05-25]

### 修复
- 解决**凤凰财经爬虫编码问题**，修复爬取的新闻不显示在Web页面的问题
- 在 `IfengCrawler` 类中添加专门的编码处理函数，支持UTF-8、GBK和GB18030多种编码格式自动识别
- 添加 `_handle_encoding` 方法，优化HTTP响应内容的编码处理

### 新增
- 为凤凰财经爬虫增加 `detect_encoding` 功能，智能识别网页编码
- 添加数据库表结构自动检查和创建功能，确保新闻数据能正确保存
- 改进文本清理功能，专门处理中文特殊字符和乱码问题

### 优化
- 优化数据库连接配置，确保中文字符能正确保存到SQLite数据库
- 重构 `get_news_detail` 方法，提高页面解析的容错性
- 增强日志系统，添加详细的编码处理日志，便于故障排查

## [2025-05-19]

### 新增
- 添加**性能统计和监控功能**，提供爬虫效率分析
- 创建性能监控仪表板，可视化展示性能数据
- 自动记录请求和数据库操作，生成实时统计报告
- 提供资源使用监控，包括CPU、内存使用情况

## [2025-05-18]

### 新增
- 为爬虫添加**数据库事务支持和并发控制**，大幅提升数据库操作可靠性
- 创建 TransactionalDBManager 类，实现数据库事务管理和并发控制
- 添加 db_transaction 上下文管理器和装饰器，简化事务操作
- 改进 AsyncCrawler 类，添加事务数据库管理支持

### 优化
- 数据库操作增加自动重试机制，提高稳定性
- 优化锁机制，避免并发写入冲突
- 添加批量保存功能，提高批量数据处理效率
- WAL 模式提升数据库性能，同时保证数据安全

## [2025-05-17]

### 新增
- 为爬虫添加**异步支持**，使用 aiohttp 实现高效并发爬取
- 创建 AsyncCrawler 基类，提供通用的异步爬取功能
- 为东方财富和凤凰财经爬虫实现异步版本
- 添加性能测试和演示脚本，对比同步与异步爬虫性能差异

### 修复
- 优化异常处理逻辑，提高爬虫稳定性

### 变更
- 更新 app/crawlers/__init__.py，支持通过 use_async 参数选择同步或异步爬虫
- 所有异步爬虫都实现了回退机制，当异步爬取失败时会尝试使用同步方式

## [2025-05-16]

### 新增
- 统一了所有爬虫的日志输出格式，采用 `%(asctime)s [%(levelname)s] [%(name)s] %(message)s` 格式
- 为每个爬虫的日志处理器设置统一命名规则，使用 `[爬虫名称]_YYYYMMDD.log` 格式
- 实现了自动检测和移除重复日志处理器的功能
- 创建并开始维护此CHANGELOG.md文件

### 修复
- 解决了不同爬虫日志输出格式不一致的问题
- 修复了某些情况下日志记录器未正确初始化的问题
- 优化了日志初始化过程，确保无重复处理器

### 变更
- 修改 `app/utils/logger.py` 中的 `configure_logger` 和 `get_crawler_logger` 函数
- 更新 NeteaseCrawler、OptimizedNeteaseCrawler 和 OptimizedSinaCrawler 类中的日志配置
- 统一了日志文件的路径和命名规则
- 优化了日志记录的内容，提供更多环境信息

## [2025-05-15]

### 新增
- 网易财经爬虫更新：根据需求禁用了广告URL过滤和广告图片过滤功能
- 现在网易财经爬虫将爬取所有符合URL格式的内容，包括之前被识别为广告的URL
- 保留所有图片内容，不再过滤可能的广告图片

## [2025-05-12]

### 修复
- 修复凤凰财经爬虫日志重复输出问题，优化日志记录机制
- 改进`get_crawler_logger`函数，确保避免日志处理器重复添加
- 增强爬虫测试脚本，提供更清晰的日志处理器状态信息

## [2025-05-01]

### 变更
- 移除腾讯财经爬虫模块，精简代码结构
- 优化爬虫管理器，提高系统稳定性
- 更新Web界面，移除腾讯财经相关选项

## [2025-04-02]

### 新增
- 增强 `AdFilter`，支持动态加载广告过滤规则
- 全面优化凤凰财经爬虫，增强页面适应性
- 扩展内容选择器范围，更新 User-Agent
- 实现智能内容识别与清理机制
- 添加短内容和特殊页面处理
- 增加多层次容错，优化日志

### 修复
- 修复数据库路径处理，避免将文件路径误认为目录
- 改进错误处理和日志记录
- 优化数据库初始化和备用目录创建

## [更早的版本]

*早期版本的更新信息将逐步从README.md文件整理到此文件*