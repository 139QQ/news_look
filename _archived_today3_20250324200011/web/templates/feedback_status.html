{% extends "base.html" %}

{% block title %}反馈状态查询 - 金融新闻爬虫系统{% endblock %}

{% block content %}
<div class="container" id="main-content">
    <div class="feedback-container">
        <h1 class="page-title">反馈状态查询</h1>
        
        <div class="feedback-tabs">
            <a href="{{ url_for('feedback') }}" class="tab-link">提交反馈</a>
            <a href="{{ url_for('feedback_status') }}" class="tab-link active">查询状态</a>
        </div>
        
        <div class="feedback-form-container">
            <form id="statusForm" class="feedback-form" aria-labelledby="status-form-title" method="get" action="{{ url_for('feedback_status') }}">
                <h2 id="status-form-title" class="form-section-title">查询您的反馈状态</h2>
                
                <div class="form-group">
                    <label for="feedbackId" class="form-label">反馈跟踪ID</label>
                    <div class="search-input-wrapper">
                        <input type="text" id="feedbackId" name="id" class="form-input" placeholder="请输入您的反馈跟踪ID，例如：FB-20230516-1234" value="{{ feedback_id or '' }}" required aria-required="true">
                        <button type="submit" class="search-button">查询</button>
                    </div>
                </div>
            </form>
        </div>
        
        {% if error_message %}
        <div class="alert alert-error" role="alert">
            {{ error_message }}
        </div>
        {% endif %}
        
        {% if feedback_data %}
        <div class="feedback-detail-container">
            <h2 class="form-section-title">反馈详情</h2>
            
            <div class="feedback-detail">
                <div class="feedback-status-badge status-{{ feedback_data.status }}">
                    {% if feedback_data.status == 'pending' %}
                    待处理
                    {% elif feedback_data.status == 'processing' %}
                    处理中
                    {% elif feedback_data.status == 'resolved' %}
                    已解决
                    {% elif feedback_data.status == 'closed' %}
                    已关闭
                    {% else %}
                    {{ feedback_data.status }}
                    {% endif %}
                </div>
                
                <div class="feedback-detail-item">
                    <div class="detail-label">跟踪ID</div>
                    <div class="detail-value">{{ feedback_data.id }}</div>
                </div>
                
                <div class="feedback-detail-item">
                    <div class="detail-label">反馈类型</div>
                    <div class="detail-value">
                        {% if feedback_data.feedback_type == 'bug' %}
                        问题报告
                        {% elif feedback_data.feedback_type == 'feature' %}
                        功能建议
                        {% elif feedback_data.feedback_type == 'improvement' %}
                        改进意见
                        {% elif feedback_data.feedback_type == 'other' %}
                        其他
                        {% else %}
                        {{ feedback_data.feedback_type }}
                        {% endif %}
                    </div>
                </div>
                
                <div class="feedback-detail-item">
                    <div class="detail-label">标题</div>
                    <div class="detail-value">{{ feedback_data.title }}</div>
                </div>
                
                <div class="feedback-detail-item">
                    <div class="detail-label">内容</div>
                    <div class="detail-value content-block">{{ feedback_data.content }}</div>
                </div>
                
                <div class="feedback-detail-item">
                    <div class="detail-label">提交时间</div>
                    <div class="detail-value">{{ feedback_data.submit_time }}</div>
                </div>
                
                <div class="feedback-detail-item">
                    <div class="detail-label">最后更新</div>
                    <div class="detail-value">{{ feedback_data.update_time }}</div>
                </div>
                
                {% if feedback_data.urgent %}
                <div class="feedback-detail-item">
                    <div class="detail-label">优先级</div>
                    <div class="detail-value urgent-badge">紧急</div>
                </div>
                {% endif %}
                
                {% if feedback_data.response %}
                <div class="feedback-detail-item response-item">
                    <div class="detail-label">官方回复</div>
                    <div class="detail-value response-block">
                        <div class="response-time">回复时间: {{ feedback_data.update_time }}</div>
                        <div class="response-content">{{ feedback_data.response }}</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <div class="feedback-help">
            <h2 class="form-section-title">帮助信息</h2>
            <div class="help-content">
                <p>如果您忘记了反馈跟踪ID，请检查以下位置：</p>
                <ul>
                    <li>提交反馈后显示的确认信息</li>
                    <li>如果您提供了电子邮箱，请查看我们发送的确认邮件</li>
                </ul>
                <p>如果您仍然无法找到您的跟踪ID，请<a href="{{ url_for('feedback') }}" class="text-link">提交新的反馈</a>，并在内容中说明您的情况。</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 表单验证
        const form = document.getElementById('statusForm');
        const input = document.getElementById('feedbackId');
        
        form.addEventListener('submit', function(e) {
            if (!input.value.trim()) {
                e.preventDefault();
                input.classList.add('input-error');
                
                const errorMessage = document.createElement('div');
                errorMessage.className = 'alert alert-error';
                errorMessage.setAttribute('role', 'alert');
                errorMessage.textContent = '请输入反馈跟踪ID';
                
                form.parentNode.insertBefore(errorMessage, form.nextSibling);
                
                setTimeout(() => {
                    errorMessage.style.opacity = '0';
                    setTimeout(() => {
                        errorMessage.remove();
                    }, 300);
                }, 3000);
            }
        });
        
        input.addEventListener('input', function() {
            this.classList.remove('input-error');
        });
    });
</script>
{% endblock %} 