# 更新日志 (CHANGELOG)

本文档记录 NewsLook 项目的所有重要更新。

## [未发布]

### 新增功能
- 添加全局404错误处理器，提供友好的错误页面
- 增强Web应用的错误处理能力
- 为所有主要路由添加完整错误处理和日志记录
- 修复新浪财经爬虫中的缩进错误问题，包括`_is_news_in_date_range`和`_process_news_links`方法
- 解决新浪财经爬虫单元测试失败问题，更新测试用例使用的分类和断言逻辑

### 问题修复
- 修复凤凰财经爬虫测试用例问题，使测试与实际实现保持一致：
  - 修正方法名称（`_detect_encoding` → `detect_encoding`）
  - 更新标题提取测试，正确处理带有"_凤凰财经"后缀的标题
  - 调整分类测试和日志验证，符合实际实现
  - 修复空标题和空内容的测试用例逻辑
- 修复导航栏链接与路由不匹配导致的404错误
- 解决首页加载失败的问题
- 修复数据中心趋势图无法显示的Bug
- 修复新浪财经爬虫日志输出到多个备份文件的问题，改为单一日志文件输出

### 代码优化
- 重构Chart.js图表初始化逻辑，提高可靠性
- 优化Web应用路由结构
- 改进日志记录机制，提供更详细的错误信息
- 增强新浪财经爬虫的日志记录系统，添加更详细的链接提取和处理日志
- 优化新浪财经爬虫的数据保存方法，确保正确调用超类的保存方法并添加必要的数据库检查
- 更新新浪财经爬虫的URL识别模式，适应网站当前结构
- 将新浪财经爬虫的日志处理器从RotatingFileHandler替换为FileHandler，简化日志管理

## [2025-04-17]

### 新增
- 添加全局404错误处理器，为用户提供友好的错误页面
- 完善错误页面模板，提供更直观的错误反馈

### 修复
- 修复站点导航404错误问题
- 完善/crawler和/settings路由的实现
- 确保所有导航栏链接都有对应的路由处理函数

### 改进
- 优化错误日志记录，提供详细的请求路径信息
- 增强系统错误处理的容错性
- 统一错误处理机制，提高用户体验

## [2025-04-16]

### 修复
- 修复首页加载失败问题，解决未定义变量(news和news_id)错误
- 优化代码结构，移除不必要的变量检查

### 改进
- 改进用户偏好处理逻辑，提高页面加载性能
- 完善错误处理和日志记录
- 优化首页模板渲染逻辑

## [2025-04-15]

### 修复
- 重构Chart.js图表初始化逻辑，彻底解决趋势图无法显示的问题

### 改进
- 添加图表实例缓存和销毁机制，避免重复初始化
- 增强图表渲染的错误捕获和可视化错误提示
- 添加DOM元素存在性检查和Canvas上下文验证
- 实现延迟重试初始化机制，解决页面元素延迟加载问题
- 优化图表配置，提高可读性和交互性

## [2025-04-14]

### 新增
- **数据中心界面全面优化**，提升数据可视化体验
  - 左侧筛选栏在滚动时保持固定可见，便于随时调整筛选条件
  - 添加日期快捷选择功能，提供近7天、近14天、近30天等快速筛选选项
  - 增加筛选加载状态提示，提升交互反馈
  - 添加数据为空时的友好提示界面
  - 实现筛选条件的一键重置功能

### 修复
- 修复趋势图无法显示的问题
- 解决已删除数据库的新闻仍然显示的问题

### 改进
- 优化左侧筛选区与主内容区域布局比例
- 增强图表和表格的视觉体验
- 添加数据检查和过滤机制，确保数据有效性
- 改进数据查询逻辑，提高统计准确性
- 增强筛选条件的交互体验
- 添加错误提示和数据加载状态显示

## [2025-04-12]

### 改进
- 全面优化用户界面，提升系统操作体验和视觉效果
- 优化新闻列表布局，采用交替背景色和标准化信息层级排版
- 改进筛选条件布局，增大间距和突出操作按钮
- 增强分页控件，提供更大的点击区域和更好的交互反馈
- 统一卡片和列表元素的视觉风格，提升整体一致性
- 添加排序功能，支持按发布时间和情感值排序
- A优化移动端响应式布局，提高不同设备的使用体验

## [2025-05-20]

### 修复
- 修复凤凰财经爬虫编码问题，解决爬取的新闻不显示在Web页面的问题

### 改进
- 增强凤凰财经爬虫的编码处理能力，支持多种编码格式自动识别（UTF-8、GBK、GB18030）
- 优化数据库连接配置，确保中文字符能正确保存
- 添加专门的文本清理函数，处理特殊字符和乱码问题
- 完善数据库结构检查，自动创建缺失的表结构

## [2025-05-19]

### 新增
- 添加性能统计和监控功能，全面分析爬虫效率
- 实时监控爬虫运行状态和资源占用
- 提供可视化仪表板，展示详细性能指标
- 支持历史数据查询和趋势分析
- 访问路径: `/monitor` 查看性能监控仪表板

## [2025-05-18]

### 新增
- 为爬虫添加数据库事务支持和并发控制，大幅提升数据库操作可靠性
- 创建 TransactionalDBManager 类，支持事务操作和并发写入

### 改进
- 数据库操作增加自动重试机制，避免锁冲突导致的失败
- 添加 WAL 模式和批量处理，提高数据库性能和稳定性

## [2025-05-17]

### 新增
- 为爬虫添加异步支持，使用 aiohttp 实现高效并发爬取
- 创建 AsyncCrawler 基类，提供通用的异步爬取功能
- 支持东方财富和凤凰财经爬虫的异步版本

### 改进
- 添加性能测试和演示脚本，异步爬虫性能提升显著
- 所有爬虫均支持回退机制，当异步爬取失败时自动使用同步方式

## [2025-05-16]

### 改进
- 统一了所有爬虫的日志输出格式，采用 `%(asctime)s [%(levelname)s] [%(name)s] %(message)s` 格式
- 统一了日志文件命名规则，使用 `[爬虫名称]_YYYYMMDD.log` 格式
- 优化了日志处理器管理，自动检测并移除重复的处理器
- 更新了爬虫类中的自定义日志设置，统一使用核心日志模块

### 新增
- 创建了CHANGELOG.md文件，开始记录项目的详细更新历史

## [2025-05-15]

### 变更
- 网易财经爬虫更新：根据需求禁用了广告URL过滤和广告图片过滤功能
- 网易财经爬虫将爬取所有符合URL格式的内容，包括之前被识别为广告的URL
- 保留所有图片内容，不再过滤可能的广告图片

## [2025-05-12]

### 修复
- 修复凤凰财经爬虫日志重复输出问题，优化日志记录机制
- 改进`get_crawler_logger`函数，确保避免日志处理器重复添加
- 增强爬虫测试脚本，提供更清晰的日志处理器状态信息

## [2025-05-01]

### 变更
- 移除腾讯财经爬虫模块，精简代码结构
- 优化爬虫管理器，提高系统稳定性
- 更新Web界面，移除腾讯财经相关选项

## [2025-04-02]

### 修复
- 修复数据库路径处理，避免将文件路径误认为目录

### 改进
- 增强 `AdFilter`，支持动态加载广告过滤规则
- 改进错误处理和日志记录
- 优化数据库初始化和备用目录创建
- 全面优化凤凰财经爬虫，增强页面适应性
- 扩展内容选择器范围，更新 User-Agent
- 实现智能内容识别与清理机制
- 添加短内容和特殊页面处理
- 增加多层次容错，优化日志

## [更早的版本]

*早期版本的更新信息将逐步从README.md文件整理到此文件*