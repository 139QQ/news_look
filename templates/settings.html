{% extends 'base.html' %}

{% block title %}系统设置 - NewsLook{% endblock %}

{% block head %}
{{ super() }}
<style>
  .settings-section {
    margin-bottom: 2.5rem;
  }
  
  .section-title {
    font-size: 1.25rem;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 0.75rem;
    color: var(--color-text-primary);
  }
  
  .settings-card {
    border-radius: var(--card-border-radius);
    box-shadow: var(--card-box-shadow);
    margin-bottom: 1rem;
  }
  
  .settings-form .form-label {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    margin-bottom: 0.5rem;
  }
  
  .settings-form .form-control {
    height: var(--input-height);
    border-radius: var(--input-border-radius);
    border-color: var(--input-border-color);
    background-color: var(--input-bg);
    color: var(--color-text-primary);
  }
  
  .settings-form .form-control:focus {
    border-color: var(--color-interactive);
    box-shadow: 0 0 0 0.25rem rgba(var(--color-interactive-rgb), 0.25);
  }
  
  .settings-form .form-select {
    height: var(--input-height);
    border-radius: var(--input-border-radius);
    border-color: var(--input-border-color);
    background-color: var(--input-bg);
    color: var(--color-text-primary);
  }
  
  .settings-form .form-select:focus {
    border-color: var(--color-interactive);
    box-shadow: 0 0 0 0.25rem rgba(var(--color-interactive-rgb), 0.25);
  }
  
  .settings-btn {
    height: var(--button-height);
    border-radius: var(--button-border-radius);
    padding: 0 1.25rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  .settings-btn.primary {
    background-color: var(--color-interactive);
    border-color: var(--color-interactive);
    color: white;
  }
  
  .settings-btn.primary:hover {
    background-color: var(--color-interactive-hover);
    border-color: var(--color-interactive-hover);
  }
  
  .settings-btn.secondary {
    background-color: transparent;
    border-color: var(--color-border);
    color: var(--color-text-primary);
  }
  
  .settings-btn.secondary:hover {
    background-color: var(--color-bg-secondary);
  }
  
  .settings-btn.danger {
    background-color: #e74c3c;
    border-color: #e74c3c;
    color: white;
  }
  
  .settings-btn.danger:hover {
    background-color: #c0392b;
    border-color: #c0392b;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-md-12">
      <h2 class="fw-light"><i class="bi bi-gear-fill me-2 text-primary"></i>系统设置</h2>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="list-group mb-4 settings-card">
        <a href="#general" class="list-group-item list-group-item-action active">一般设置</a>
        <a href="#crawler" class="list-group-item list-group-item-action">爬虫设置</a>
        <a href="#notification" class="list-group-item list-group-item-action">通知设置</a>
        <a href="#backup" class="list-group-item list-group-item-action">备份还原</a>
      </div>
    </div>
    
    <div class="col-md-9">
      <div class="settings-card card">
        <div class="card-body">
          <!-- 一般设置 -->
          <div id="general" class="settings-section">
            <h3 class="section-title">一般设置</h3>
            <form class="settings-form">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="site_name" class="form-label">网站名称</label>
                  <input type="text" class="form-control" id="site_name" value="新闻聚合平台">
                </div>
                <div class="col-md-6">
                  <label for="site_desc" class="form-label">网站描述</label>
                  <input type="text" class="form-control" id="site_desc" value="实时汇总财经新闻资讯">
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="language" class="form-label">默认语言</label>
                  <select class="form-select" id="language">
                    <option value="zh-CN" selected>简体中文</option>
                    <option value="en-US">English</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="timezone" class="form-label">时区</label>
                  <select class="form-select" id="timezone">
                    <option value="Asia/Shanghai" selected>中国标准时间 (UTC+8)</option>
                    <option value="America/New_York">美国东部时间</option>
                    <option value="Europe/London">伦敦</option>
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="items_per_page" class="form-label">每页显示条目数</label>
                <select class="form-select" id="items_per_page">
                  <option value="10">10</option>
                  <option value="20" selected>20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </div>
              
              <div class="d-flex">
                <button type="submit" class="settings-btn primary">保存设置</button>
              </div>
            </form>
          </div>
          
          <!-- 爬虫设置 -->
          <div id="crawler" class="settings-section">
            <h3 class="section-title">爬虫设置</h3>
            <form class="settings-form">
              <div class="mb-3">
                <label for="crawl_interval" class="form-label">爬取间隔（小时）</label>
                <select class="form-select" id="crawl_interval">
                  <option value="1">1小时</option>
                  <option value="3">3小时</option>
                  <option value="6" selected>6小时</option>
                  <option value="12">12小时</option>
                  <option value="24">24小时</option>
                </select>
              </div>
              
              <div class="mb-3">
                <label for="default_sources" class="form-label">默认新闻源</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="source_sina" checked>
                  <label class="form-check-label" for="source_sina">新浪财经</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="source_eastmoney" checked>
                  <label class="form-check-label" for="source_eastmoney">东方财富</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="source_netease" checked>
                  <label class="form-check-label" for="source_netease">网易财经</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="source_phoenix">
                  <label class="form-check-label" for="source_phoenix">凤凰财经</label>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="max_pages" class="form-label">每次爬取最大页数</label>
                <input type="number" class="form-control" id="max_pages" value="5">
              </div>
              
              <div class="mb-3">
                <label for="request_delay" class="form-label">请求延迟（秒）</label>
                <input type="number" class="form-control" id="request_delay" value="3">
                <div class="form-text">防止被目标网站封禁的延迟时间</div>
              </div>
              
              <div class="d-flex">
                <button type="submit" class="settings-btn primary">保存设置</button>
              </div>
            </form>
          </div>
          
          <!-- 通知设置 -->
          <div id="notification" class="settings-section">
            <h3 class="section-title">通知设置</h3>
            <form class="settings-form">
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="enable_email" checked>
                  <label class="form-check-label" for="enable_email">启用邮件通知</label>
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="smtp_server" class="form-label">SMTP服务器</label>
                  <input type="text" class="form-control" id="smtp_server" value="smtp.example.com">
                </div>
                <div class="col-md-6">
                  <label for="smtp_port" class="form-label">SMTP端口</label>
                  <input type="number" class="form-control" id="smtp_port" value="587">
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="smtp_username" class="form-label">SMTP用户名</label>
                  <input type="text" class="form-control" id="smtp_username">
                </div>
                <div class="col-md-6">
                  <label for="smtp_password" class="form-label">SMTP密码</label>
                  <input type="password" class="form-control" id="smtp_password">
                </div>
              </div>
              
              <div class="mb-3">
                <label for="notification_email" class="form-label">通知接收邮箱</label>
                <input type="email" class="form-control" id="notification_email">
              </div>
              
              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="notify_errors" checked>
                  <label class="form-check-label" for="notify_errors">爬虫错误时通知</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="notify_success">
                  <label class="form-check-label" for="notify_success">爬虫完成时通知</label>
                </div>
              </div>
              
              <div class="d-flex">
                <button type="submit" class="settings-btn primary me-2">保存设置</button>
                <button type="button" class="settings-btn secondary">发送测试邮件</button>
              </div>
            </form>
          </div>
          
          <!-- 备份还原 -->
          <div id="backup" class="settings-section">
            <h3 class="section-title">备份还原</h3>
            <form class="settings-form">
              <div class="mb-3">
                <label class="form-label">数据备份</label>
                <div class="d-flex">
                  <button type="button" class="settings-btn primary me-2">
                    <i class="bi bi-download me-1"></i>导出数据库
                  </button>
                  <button type="button" class="settings-btn secondary">
                    <i class="bi bi-download me-1"></i>导出配置
                  </button>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="restore_file" class="form-label">数据还原</label>
                <input class="form-control mb-2" type="file" id="restore_file">
                <button type="button" class="settings-btn secondary">
                  <i class="bi bi-upload me-1"></i>导入数据
                </button>
              </div>
              
              <div class="mb-3">
                <label class="form-label">系统重置</label>
                <div>
                  <button type="button" class="settings-btn danger">
                    <i class="bi bi-trash me-1"></i>重置系统
                  </button>
                </div>
                <div class="form-text text-danger">警告：此操作将清空所有数据，且不可恢复！</div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 处理设置导航
    const navLinks = document.querySelectorAll('.list-group-item-action');
    navLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // 移除所有活动状态
        navLinks.forEach(function(item) {
          item.classList.remove('active');
        });
        
        // 添加活动状态到当前点击的项目
        this.classList.add('active');
        
        // 滚动到相应的部分
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        targetElement.scrollIntoView({ behavior: 'smooth' });
      });
    });
    
    // 表单提交处理
    const forms = document.querySelectorAll('.settings-form');
    forms.forEach(function(form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 在实际应用中，这里应该发送AJAX请求保存设置
        alert('设置已保存');
      });
    });
    
    // 测试邮件按钮
    const testEmailBtn = document.querySelector('.settings-btn.secondary');
    if (testEmailBtn) {
      testEmailBtn.addEventListener('click', function() {
        alert('测试邮件已发送');
      });
    }
    
    // 重置系统按钮
    const resetBtn = document.querySelector('.settings-btn.danger');
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        if (confirm('确定要重置系统吗？此操作不可恢复！')) {
          alert('系统已重置');
        }
      });
    }
  });
</script>
{% endblock %} 