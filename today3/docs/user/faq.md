# 常见问题解答 (FAQ)

本文档收集了使用金融新闻爬虫系统时的常见问题及解答。如果您在使用过程中遇到问题，请先查阅本文档寻找解决方案。

## 1. 安装与配置

### 1.1 安装时出现依赖冲突怎么办？

**问题**：安装依赖包时出现版本冲突。

**解答**：
- 创建全新的虚拟环境再安装
- 按照错误信息中的建议，手动安装指定版本的依赖
- 尝试使用 `pip install --no-deps` 安装冲突的包，然后手动安装其依赖

### 1.2 如何在不同操作系统上安装？

**问题**：在Windows/Linux/macOS上安装有差异吗？

**解答**：主要差异在于Python环境的设置和文件路径表示方式。请参考[安装指南](./installation.md)中特定操作系统的说明。Windows用户可能需要额外安装Visual C++ Build Tools来编译某些依赖包。

### 1.3 可以在Docker中运行吗？

**问题**：如何使用Docker运行爬虫系统？

**解答**：
是的，可以使用Docker运行。我们提供了Dockerfile，您可以按照以下步骤操作：
```bash
# 构建Docker镜像
docker build -t finance-news-crawler .

# 运行容器
docker run -p 5000:5000 -v $(pwd)/data:/app/data -v $(pwd)/logs:/app/logs finance-news-crawler
```

## 2. 运行与使用

### 2.1 爬虫运行很慢，如何提升速度？

**问题**：爬虫执行速度较慢，特别是在爬取大量新闻时。

**解答**：
- 增加并行工作线程：`--workers 8`（根据您的CPU核心数调整）
- 使用简化版爬虫：`run_eastmoney_simple.py`
- 检查网络连接，必要时使用代理：`--use-proxy`
- 减少请求间隔：`--delay 0.5`（但请注意不要设置过低以避免IP被封）
- 如果只需要最新数据，减少爬取天数：`--days 1`

### 2.2 如何爬取特定日期范围的新闻？

**问题**：想爬取指定日期范围内的新闻，而不是最近几天的。

**解答**：
当前版本默认只支持爬取最近N天的新闻。如果需要爬取特定日期范围，您可以：
1. 修改源代码中的日期计算逻辑
2. 针对支持历史查询的网站，可以开发自定义爬虫
3. 使用`run_crawler.py`脚本的`--start-date`和`--end-date`参数（如果已实现）

### 2.3 如何处理被网站封IP的情况？

**问题**：频繁爬取后被目标网站限制或封锁。

**解答**：
- 增加请求间隔：`--delay 3`（秒）
- 使用代理：`--use-proxy`
- 随机化用户代理（在配置文件中添加更多USER_AGENTS）
- 实现自动IP轮换机制
- 减少同时并发的请求数
- 避免短时间内对同一网站发送大量请求

### 2.4 数据库文件变得很大怎么办？

**问题**：长期使用后，SQLite数据库文件变得很大。

**解答**：
- 定期清理旧数据：`python scripts/cleanup_data.py --before 2023-01-01`
- 优化数据库：`python scripts/optimize_db.py`
- 考虑迁移到更适合大数据量的数据库，如MySQL或PostgreSQL
- 实现数据分区策略，例如按月创建不同的数据表

## 3. 爬虫功能

### 3.1 如何添加新的爬虫来源？

**问题**：想添加目前不支持的新闻网站爬虫。

**解答**：
1. 在`app/crawlers`目录下创建新的爬虫类文件
2. 继承`BaseCrawler`类并实现必要的方法
3. 在`app/crawlers/__init__.py`中注册新爬虫
4. 详细步骤请参考[使用指南](./usage.md)中的"定制开发"部分

### 3.2 如何修改新闻处理逻辑？

**问题**：想自定义爬取的内容或添加额外的数据处理。

**解答**：
- 扩展相应爬虫类的`parse_news`方法
- 在`app/processors`目录下添加自定义处理器
- 修改数据模型以存储额外的信息
- 考虑使用钩子(hooks)方法在不同处理阶段执行自定义逻辑

### 3.3 爬虫无法正确解析某些页面内容？

**问题**：爬虫在某些页面无法正确提取内容。

**解答**：
- 网站可能更新了HTML结构，需要更新选择器
- 检查页面是否使用了JavaScript动态加载内容，可能需要使用Selenium
- 尝试使用`--log-level DEBUG`查看详细日志，定位问题
- 对于复杂页面，考虑实现多级选择器策略或备选解析方法

## 4. 数据管理

### 4.1 如何导出特定类别的新闻？

**问题**：只想导出某个特定类别或来源的新闻。

**解答**：
使用导出脚本的筛选参数：
```bash
python scripts/export_data.py --format csv --output category_news.csv --category 期货
```
或者使用SQL查询导出：
```bash
sqlite3 data/finance_news.db "SELECT * FROM news WHERE category='期货'" -csv > category_news.csv
```

### 4.2 如何避免重复爬取同一新闻？

**问题**：多次运行爬虫会导致数据库中出现重复条目。

**解答**：
- 系统默认会检查URL是否已存在于数据库中，避免重复爬取
- 确保您的数据库表有适当的唯一索引
- 可以使用`--skip-existing`参数（如果已实现）
- 如果仍有问题，可以运行去重脚本：`python scripts/remove_duplicates.py`

### 4.3 如何进行数据备份？

**问题**：担心数据丢失，需要定期备份。

**解答**：
可以使用以下方法备份SQLite数据库：
```bash
# 方法1：复制文件
cp data/finance_news.db data/finance_news_backup_$(date +%Y%m%d).db

# 方法2：使用SQLite备份命令
sqlite3 data/finance_news.db ".backup 'data/finance_news_backup.db'"

# 方法3：导出为SQL语句
sqlite3 data/finance_news.db ".dump" > data/finance_news_dump_$(date +%Y%m%d).sql
```

## 5. 调度与自动化

### 5.1 如何设置定时爬取？

**问题**：希望系统自动定期爬取新闻。

**解答**：
- 使用调度器：`python run_scheduler.py`
- 使用系统的定时任务工具（cron、Windows任务计划）
- 在服务器上部署为持续运行的服务
详细配置请参考[使用指南](./usage.md)中的"实用示例"部分。

### 5.2 爬虫任务失败后会自动重试吗？

**问题**：网络不稳定时，爬虫任务可能失败。

**解答**：
- 系统默认会对失败的请求进行有限次数的重试
- 可以通过`--max-retries`参数（如果已实现）调整重试次数
- 调度器有失败任务的恢复机制
- 对于完全失败的爬取，可以实现监控脚本定期检查并重启

### 5.3 如何监控爬虫运行状态？

**问题**：需要了解爬虫任务的执行情况。

**解答**：
- 查看日志文件：`logs/爬虫名称/日期.log`
- 实现状态API或Web界面（如果已实现）
- 使用第三方监控工具如Prometheus+Grafana
- 设置关键错误的邮件或消息通知

## 6. 性能与资源

### 6.1 爬虫占用内存过多怎么办？

**问题**：运行爬虫时内存使用率很高。

**解答**：
- 减少并行工作线程数：`--workers 2`
- 限制最大爬取数量：`--max-news 100`
- 确保正确关闭资源，检查是否有内存泄漏
- 考虑使用生成器而不是列表存储中间结果
- 使用流式处理方式处理大量数据

### 6.2 如何优化CPU使用率？

**问题**：爬虫运行时CPU使用率很高。

**解答**：
- 调整工作线程数与CPU核心数匹配
- 减少复杂的内容处理逻辑
- 使用带有超时的批处理模式
- 检查是否有不必要的计算或循环

### 6.3 爬虫程序崩溃如何处理？

**问题**：爬虫在运行一段时间后崩溃。

**解答**：
- 检查日志文件找出崩溃原因
- 添加异常捕获和错误处理逻辑
- 使用supervisor等工具监控进程并自动重启
- 实现检查点机制，允许从上次中断处继续
- 考虑分批处理数据以减少单次运行的负担

## 7. 其他问题

### 7.1 如何贡献代码？

**问题**：想为项目贡献代码或修复bug。

**解答**：
请参考[贡献指南](../development/contribution.md)，按照以下步骤操作：
1. Fork项目仓库
2. 创建功能分支
3. 提交您的更改
4. 发起Pull Request
5. 等待代码审查和合并

### 7.2 项目的许可证是什么？

**问题**：关于代码使用和分发的法律条款。

**解答**：
本项目采用MIT许可证。您可以自由使用、修改和分发代码，但需保留原始许可证声明。详情请参阅项目根目录下的LICENSE文件。

### 7.3 如何报告安全漏洞？

**问题**：发现安全相关问题需要报告。

**解答**：
请勿在公开Issue中报告安全漏洞。请直接联系项目维护者：security@example.com，或使用GitHub的安全漏洞报告功能。

## 8. 联系与支持

如果您的问题在本FAQ中未能找到解答，请通过以下渠道获取支持：

- 在GitHub仓库提交Issue
- 发送邮件至支持邮箱：support@example.com
- 加入项目的讨论组或社区论坛

我们会定期更新此FAQ，以包含用户常见的新问题和解决方案。 